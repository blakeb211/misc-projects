#calculate grid id from position

min <- c(-12.000,-2.900,-45.100,
-4.971,-2.900,-45.100,
2.057,-2.900,-45.100,
9.086,-2.900,-45.100,
16.114,-2.900,-45.100,
23.143,-2.900,-45.100,
30.171,-2.900,-45.100,
-12.000,-2.900,-38.071,
-4.971,-2.900,-38.071,
2.057,-2.900,-38.071,
9.086,-2.900,-38.071,
16.114,-2.900,-38.071,
23.143,-2.900,-38.071,
30.171,-2.900,-38.071,
-12.000,-2.900,-31.043,
-4.971,-2.900,-31.043,
2.057,-2.900,-31.043,
9.086,-2.900,-31.043,
16.114,-2.900,-31.043,
23.143,-2.900,-31.043,
30.171,-2.900,-31.043,
-12.000,-2.900,-24.014,
-4.971,-2.900,-24.014,
2.057,-2.900,-24.014,
9.086,-2.900,-24.014,
16.114,-2.900,-24.014,
23.143,-2.900,-24.014,
30.171,-2.900,-24.014,
-12.000,-2.900,-16.986,
-4.971,-2.900,-16.986,
2.057,-2.900,-16.986,
9.086,-2.900,-16.986,
16.114,-2.900,-16.986,
23.143,-2.900,-16.986,
30.171,-2.900,-16.986,
-12.000,-2.900,-9.957,
-4.971,-2.900,-9.957,
2.057,-2.900,-9.957,
9.086,-2.900,-9.957,
16.114,-2.900,-9.957,
23.143,-2.900,-9.957,
30.171,-2.900,-9.957,
-12.000,-2.900,-2.929,
-4.971,-2.900,-2.929,
2.057,-2.900,-2.929,
9.086,-2.900,-2.929,
16.114,-2.900,-2.929,
23.143,-2.900,-2.929,
30.171,-2.900,-2.929,
-12.000,4.129,-45.100,
-4.971,4.129,-45.100,
2.057,4.129,-45.100,
9.086,4.129,-45.100,
16.114,4.129,-45.100,
23.143,4.129,-45.100,
30.171,4.129,-45.100,
-12.000,4.129,-38.071,
-4.971,4.129,-38.071,
2.057,4.129,-38.071,
9.086,4.129,-38.071,
16.114,4.129,-38.071,
23.143,4.129,-38.071,
30.171,4.129,-38.071,
-12.000,4.129,-31.043,
-4.971,4.129,-31.043,
2.057,4.129,-31.043,
9.086,4.129,-31.043,
16.114,4.129,-31.043,
23.143,4.129,-31.043,
30.171,4.129,-31.043,
-12.000,4.129,-24.014,
-4.971,4.129,-24.014,
2.057,4.129,-24.014,
9.086,4.129,-24.014,
16.114,4.129,-24.014,
23.143,4.129,-24.014,
30.171,4.129,-24.014,
-12.000,4.129,-16.986,
-4.971,4.129,-16.986,
2.057,4.129,-16.986,
9.086,4.129,-16.986,
16.114,4.129,-16.986,
23.143,4.129,-16.986,
30.171,4.129,-16.986,
-12.000,4.129,-9.957,
-4.971,4.129,-9.957,
2.057,4.129,-9.957,
9.086,4.129,-9.957,
16.114,4.129,-9.957,
23.143,4.129,-9.957,
30.171,4.129,-9.957,
-12.000,4.129,-2.929,
-4.971,4.129,-2.929,
2.057,4.129,-2.929,
9.086,4.129,-2.929,
16.114,4.129,-2.929,
23.143,4.129,-2.929,
30.171,4.129,-2.929,
-12.000,11.157,-45.100,
-4.971,11.157,-45.100,
2.057,11.157,-45.100,
9.086,11.157,-45.100,
16.114,11.157,-45.100,
23.143,11.157,-45.100,
30.171,11.157,-45.100,
-12.000,11.157,-38.071,
-4.971,11.157,-38.071,
2.057,11.157,-38.071,
9.086,11.157,-38.071,
16.114,11.157,-38.071,
23.143,11.157,-38.071,
30.171,11.157,-38.071,
-12.000,11.157,-31.043,
-4.971,11.157,-31.043,
2.057,11.157,-31.043,
9.086,11.157,-31.043,
16.114,11.157,-31.043,
23.143,11.157,-31.043,
30.171,11.157,-31.043,
-12.000,11.157,-24.014,
-4.971,11.157,-24.014,
2.057,11.157,-24.014,
9.086,11.157,-24.014,
16.114,11.157,-24.014,
23.143,11.157,-24.014,
30.171,11.157,-24.014,
-12.000,11.157,-16.986,
-4.971,11.157,-16.986,
2.057,11.157,-16.986,
9.086,11.157,-16.986,
16.114,11.157,-16.986,
23.143,11.157,-16.986,
30.171,11.157,-16.986,
-12.000,11.157,-9.957,
-4.971,11.157,-9.957,
2.057,11.157,-9.957,
9.086,11.157,-9.957,
16.114,11.157,-9.957,
23.143,11.157,-9.957,
30.171,11.157,-9.957,
-12.000,11.157,-2.929,
-4.971,11.157,-2.929,
2.057,11.157,-2.929,
9.086,11.157,-2.929,
16.114,11.157,-2.929,
23.143,11.157,-2.929,
30.171,11.157,-2.929,
-12.000,18.186,-45.100,
-4.971,18.186,-45.100,
2.057,18.186,-45.100,
9.086,18.186,-45.100,
16.114,18.186,-45.100,
23.143,18.186,-45.100,
30.171,18.186,-45.100,
-12.000,18.186,-38.071,
-4.971,18.186,-38.071,
2.057,18.186,-38.071,
9.086,18.186,-38.071,
16.114,18.186,-38.071,
23.143,18.186,-38.071,
30.171,18.186,-38.071,
-12.000,18.186,-31.043,
-4.971,18.186,-31.043,
2.057,18.186,-31.043,
9.086,18.186,-31.043,
16.114,18.186,-31.043,
23.143,18.186,-31.043,
30.171,18.186,-31.043,
-12.000,18.186,-24.014,
-4.971,18.186,-24.014,
2.057,18.186,-24.014,
9.086,18.186,-24.014,
16.114,18.186,-24.014,
23.143,18.186,-24.014,
30.171,18.186,-24.014,
-12.000,18.186,-16.986,
-4.971,18.186,-16.986,
2.057,18.186,-16.986,
9.086,18.186,-16.986,
16.114,18.186,-16.986,
23.143,18.186,-16.986,
30.171,18.186,-16.986,
-12.000,18.186,-9.957,
-4.971,18.186,-9.957,
2.057,18.186,-9.957,
9.086,18.186,-9.957,
16.114,18.186,-9.957,
23.143,18.186,-9.957,
30.171,18.186,-9.957,
-12.000,18.186,-2.929,
-4.971,18.186,-2.929,
2.057,18.186,-2.929,
9.086,18.186,-2.929,
16.114,18.186,-2.929,
23.143,18.186,-2.929,
30.171,18.186,-2.929,
-12.000,25.214,-45.100,
-4.971,25.214,-45.100,
2.057,25.214,-45.100,
9.086,25.214,-45.100,
16.114,25.214,-45.100,
23.143,25.214,-45.100,
30.171,25.214,-45.100,
-12.000,25.214,-38.071,
-4.971,25.214,-38.071,
2.057,25.214,-38.071,
9.086,25.214,-38.071,
16.114,25.214,-38.071,
23.143,25.214,-38.071,
30.171,25.214,-38.071,
-12.000,25.214,-31.043,
-4.971,25.214,-31.043,
2.057,25.214,-31.043,
9.086,25.214,-31.043,
16.114,25.214,-31.043,
23.143,25.214,-31.043,
30.171,25.214,-31.043,
-12.000,25.214,-24.014,
-4.971,25.214,-24.014,
2.057,25.214,-24.014,
9.086,25.214,-24.014,
16.114,25.214,-24.014,
23.143,25.214,-24.014,
30.171,25.214,-24.014,
-12.000,25.214,-16.986,
-4.971,25.214,-16.986,
2.057,25.214,-16.986,
9.086,25.214,-16.986,
16.114,25.214,-16.986,
23.143,25.214,-16.986,
30.171,25.214,-16.986,
-12.000,25.214,-9.957,
-4.971,25.214,-9.957,
2.057,25.214,-9.957,
9.086,25.214,-9.957,
16.114,25.214,-9.957,
23.143,25.214,-9.957,
30.171,25.214,-9.957,
-12.000,25.214,-2.929,
-4.971,25.214,-2.929,
2.057,25.214,-2.929,
9.086,25.214,-2.929,
16.114,25.214,-2.929,
23.143,25.214,-2.929,
30.171,25.214,-2.929,
-12.000,32.243,-45.100,
-4.971,32.243,-45.100,
2.057,32.243,-45.100,
9.086,32.243,-45.100,
16.114,32.243,-45.100,
23.143,32.243,-45.100,
30.171,32.243,-45.100,
-12.000,32.243,-38.071,
-4.971,32.243,-38.071,
2.057,32.243,-38.071,
9.086,32.243,-38.071,
16.114,32.243,-38.071,
23.143,32.243,-38.071,
30.171,32.243,-38.071,
-12.000,32.243,-31.043,
-4.971,32.243,-31.043,
2.057,32.243,-31.043,
9.086,32.243,-31.043,
16.114,32.243,-31.043,
23.143,32.243,-31.043,
30.171,32.243,-31.043,
-12.000,32.243,-24.014,
-4.971,32.243,-24.014,
2.057,32.243,-24.014,
9.086,32.243,-24.014,
16.114,32.243,-24.014,
23.143,32.243,-24.014,
30.171,32.243,-24.014,
-12.000,32.243,-16.986,
-4.971,32.243,-16.986,
2.057,32.243,-16.986,
9.086,32.243,-16.986,
16.114,32.243,-16.986,
23.143,32.243,-16.986,
30.171,32.243,-16.986,
-12.000,32.243,-9.957,
-4.971,32.243,-9.957,
2.057,32.243,-9.957,
9.086,32.243,-9.957,
16.114,32.243,-9.957,
23.143,32.243,-9.957,
30.171,32.243,-9.957,
-12.000,32.243,-2.929,
-4.971,32.243,-2.929,
2.057,32.243,-2.929,
9.086,32.243,-2.929,
16.114,32.243,-2.929,
23.143,32.243,-2.929,
30.171,32.243,-2.929,
-12.000,39.271,-45.100,
-4.971,39.271,-45.100,
2.057,39.271,-45.100,
9.086,39.271,-45.100,
16.114,39.271,-45.100,
23.143,39.271,-45.100,
30.171,39.271,-45.100,
-12.000,39.271,-38.071,
-4.971,39.271,-38.071,
2.057,39.271,-38.071,
9.086,39.271,-38.071,
16.114,39.271,-38.071,
23.143,39.271,-38.071,
30.171,39.271,-38.071,
-12.000,39.271,-31.043,
-4.971,39.271,-31.043,
2.057,39.271,-31.043,
9.086,39.271,-31.043,
16.114,39.271,-31.043,
23.143,39.271,-31.043,
30.171,39.271,-31.043,
-12.000,39.271,-24.014,
-4.971,39.271,-24.014,
2.057,39.271,-24.014,
9.086,39.271,-24.014,
16.114,39.271,-24.014,
23.143,39.271,-24.014,
30.171,39.271,-24.014,
-12.000,39.271,-16.986,
-4.971,39.271,-16.986,
2.057,39.271,-16.986,
9.086,39.271,-16.986,
16.114,39.271,-16.986,
23.143,39.271,-16.986,
30.171,39.271,-16.986,
-12.000,39.271,-9.957,
-4.971,39.271,-9.957,
2.057,39.271,-9.957,
9.086,39.271,-9.957,
16.114,39.271,-9.957,
23.143,39.271,-9.957,
30.171,39.271,-9.957,
-12.000,39.271,-2.929,
-4.971,39.271,-2.929,
2.057,39.271,-2.929,
9.086,39.271,-2.929,
16.114,39.271,-2.929,
23.143,39.271,-2.929,
30.171,39.271,-2.929)

mat<-matrix(data=min,ncol=3,byrow=TRUE)
colnames(mat)<-c("x","y","z")


library(scatterplot3d)
gridplot <- scatterplot3d(mat)

min <- c(mat[1,])
cellL <- 7.029

calc_id <- function(pos) {
  if (length(pos) != 3) { warning("only pass in 3-vectors!!") }
  floor((pos - min)/cellL)
}

# should give (2,0,1)
test_pos1 <- c(2.057,-2.900,-38.071) + 0.5*cellL
# should give (6, 6, 6)
test_pos2 <- c(30.171,39.271,-2.929) + 0.5*cellL
# test on a boundary, should give (2,0,1) but does not
test_pos3 <- c(2.057,-2.900,-38.071)

gridplot$points3d(matrix(test_pos1,ncol=3,byrow=TRUE), pch = 16)
gridplot$points3d(matrix(test_pos2,ncol=3,byrow=TRUE), pch = 8)

print(calc_id(test_pos1))
print(calc_id(test_pos2))

# note that discrepancy shown below when testing on a boundary
# is because we pasted this data in at a low level of precision.
# internally the game holds the cellL value at a higher precision
# than 3 decimal points
print(calc_id(test_pos3))